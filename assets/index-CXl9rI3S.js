import{_ as y}from"./ValaxyMain.vue_vue_type_style_index_0_lang-DxC2i5ri.js";import{_ as f}from"./TxDownload.vue_vue_type_style_index_0_lang-Bt3c6gtA.js";import{k as b,w as r,j as $,l as A,p as m,o as v,a as l,d as o,b as p,m as s}from"./app-DTK7MkJ3.js";import"./YunCloud-DCyQUbCJ.js";import"./tags-BE9ZZJqn.js";import"./YunFooter.vue_vue_type_script_setup_true_lang-CUf0HJdH.js";import"./YunCard.vue_vue_type_script_setup_true_lang-BEU4nSCu.js";import"./YunPostMeta.vue_vue_type_style_index_0_lang-BeL1C_Sa.js";import"./index-kt1v7PTw.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang-CQk4e2hF.js";import"./post-TpcOcCSC.js";const N="/assets/01-B0rd97c6.jpg",S="/assets/02-CyJg3Zba.jpg",H={__name:"index",setup(k,{expose:d}){const e=JSON.parse('{"title":"平台bug：注册号漂移","description":"","frontmatter":{"title":"平台bug：注册号漂移","date":"2021-05-16","updated":"2021-05-23","categories":["其他教程","细节"],"tags":["进阶"],"author":"竹蜻蜓(Heli)","sponsor":false},"headers":[],"relativePath":"pages/posts/platform-bug-registration-number-shift/index.md","path":"C:/code/web/valaxy-blog/pages/posts/platform-bug-registration-number-shift/index.md","lastUpdated":null}'),i=A(),u=e.frontmatter||{};return i.meta.frontmatter=Object.assign(i.meta.frontmatter||{},e.frontmatter||{}),m("pageData",e),m("valaxy:frontmatter",u),globalThis.$frontmatter=u,d({frontmatter:{title:"平台bug：注册号漂移",date:"2021-05-16",updated:"2021-05-23",categories:["其他教程","细节"],tags:["进阶"],author:"竹蜻蜓(Heli)",sponsor:!1}}),(n,t)=>{const g=f,a=y;return v(),b(a,{frontmatter:$(u)},{"main-content-md":r(()=>[t[0]||(t[0]=l("blockquote",null,[l("p",null,[o("Ra2map：本文转载自"),l("a",{href:"http://pkuit.com/forum.php?mod=viewthread&tid=204594&extra=page%3D1",target:"_blank",rel:"noreferrer"},"【教程】平台bug：注册号漂移 - 红警任务之家")])],-1)),t[1]||(t[1]=l("p",null,[l("em",null,"本教程整理自我在2021.5.10回复visa6000提问的邮件。感谢他的提问。")],-1)),t[2]||(t[2]=l("p",null,"相信不少任务制作者都遇到过一个坑：",-1)),t[3]||(t[3]=l("p",null,[o("在FinalAlert中，有些地方需要使用"),l("strong",null,"注册号"),o("作为触发或者脚本的参数（比如触发条件“19 建造特定类型的建筑…”，触发结果“41 播放动画在…”，脚本“移动到己方建筑”等）。")],-1)),t[4]||(t[4]=l("p",null,[o("但我们时常发现，在使用原版的rules文件时，对于一些序号比较大的建筑或者动画，"),l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("（就是“填写这个注册号，触发和脚本才会正确的起作用”，下文全部用"),l("strong",{style:{color:"blue"}},"蓝色"),o("表示）、"),l("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("（就是“地图编辑器下拉框中，我所需要的正确物品的名称对应的序号”，下文全部用"),l("strong",{style:{color:"green"}},"绿色"),o("表示）和"),l("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号"),o("（下文全部用"),l("strong",{style:{color:"red"}},"红色"),o("表示）是存在差异的，或者说，是有“漂移”的。")],-1)),t[5]||(t[5]=l("p",null,[o("先举一个例子说明这三种序号的差别，以建筑列表的"),l("strong",null,"尤里建造厂"),o("为例：")],-1)),t[6]||(t[6]=l("ul",null,[l("li",null,[l("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号——305"),o("：在rulesmd.ini中可以查到，"),l("strong",{style:{color:"red"}},"305=YACNST")]),l("li",null,[l("strong",{style:{color:"green"}},"地图编辑器中显示的序号——301"),o("：在地图编辑器中的下拉框中可以看到，"),l("strong",{style:{color:"green"}},"301 尤里建造厂")]),l("li",null,[l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号——300"),o("：经过试验可以确认（地图编辑器里面300号是"),l("strong",{style:{color:"blue"}},"公车站"),o("，囧）。")])],-1)),t[7]||(t[7]=l("figure",null,[l("img",{src:N,alt:"",loading:"lazy",decoding:"async"})],-1)),t[8]||(t[8]=l("p",null,"这种漂移在建筑序号中是漂移一点点，但在动画列表中就是大幅度跳跃了。",-1)),t[9]||(t[9]=l("p",null,[o("一个非常典型的例子就是超时空传送效果的动画，"),l("strong",null,"CHRONOTG"),o("，其正确的内部号码是"),l("strong",{style:{color:"blue"}},"257"),o("，然而在rulesmd的[Animations]注册表中的注册号是"),l("strong",{style:{color:"red"}},"668"),o("，在地图编辑器中显示的号码是"),l("strong",{style:{color:"green"}},"261"),o("。如果按照后两个号码来填写，前者会导致游戏直接出错，后者会播放错误的动画。")],-1)),t[10]||(t[10]=l("hr",null,null,-1)),t[11]||(t[11]=l("p",null,"这种漂移已经算是bug了。那么这个bug有没有规律可言呢？答案是有的。",-1)),t[12]||(t[12]=l("p",null,[o("在阅读原版的rulesmd.ini的时候，你会发现这些列表中的注册是有"),l("strong",null,"重复"),o("的，也有序号大幅度"),l("strong",null,"跳跃"),o("的状况：")],-1)),t[13]||(t[13]=l("figure",null,[l("img",{src:S,alt:"",loading:"lazy",decoding:"async"})],-1)),t[14]||(t[14]=l("p",null,[o("上图是原版的rulesmd.ini中[Animations]注册表的一部分。可以注意到有效的注册号并不是连续的，"),l("strong",{style:{color:"red"}},"318"),o("之后跳到了"),l("strong",{style:{color:"red"}},"321，334"),o("之后直接跨越到了"),l("strong",{style:{color:"red"}},"500"),o("，然后又跳步到"),l("strong",{style:{color:"red"}},"510"),o("。游戏内部读取这些动画的时候，明显是按照读取的顺序，给每一项"),l("strong",{style:{color:"blue"}},"重新依次编号了"),o("。")],-1)),t[15]||(t[15]=l("p",null,[o("种种迹象表明，从"),l("strong",{style:{color:"red"}},"在rules文件中的注册号"),o("到"),l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("之间，重新编号的规律是这样的：")],-1)),t[16]||(t[16]=l("ul",null,[l("li",null,"从上到下按顺序读取每一个项目。"),l("li",null,"空白的项目（只有注册号，等号后面没有东西）原样保留，不进行合并和删除。"),l("li",null,"非空的重复项目，以先读取的项目为准，后面的会被删除。"),l("li",null,"读取所有项目以后，再从头到尾从0开始重新编号。")],-1)),t[17]||(t[17]=l("p",null,"如果你有编程基础，你可以写一个程序来处理这种改变。",-1)),t[18]||(t[18]=l("p",null,[o("而地图编辑器读取序号的时候，处理了“跳步”的问题，但是没有处理“重复”的问题，这导致"),l("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("与另外两种序号可能都不一样。")],-1)),t[19]||(t[19]=l("hr",null,null,-1)),t[20]||(t[20]=l("p",null,[o("下面举一个例子，以开头的"),l("strong",null,"尤里建造厂"),o("为例，手工分析一下各种序号的漂移状况：")],-1)),t[21]||(t[21]=l("p",null,[o("建筑列表的注册号从"),l("strong",{style:{color:"red"}},"1=GAPOWR"),o("开始的（而不是从0开始，这直接导致了漂移1号）；在"),l("strong",{style:{color:"red"}},"253、273和304"),o("各跳了1号；而"),l("strong",{style:{color:"red"}},"241=NAPSYA和185=NAPSYA"),o("注册了两次。没有其余的异常状况。")],-1)),t[22]||(t[22]=l("p",null,[o("因此对于"),l("strong",{style:{color:"red"}},"305=YACNST"),o("：")],-1)),t[23]||(t[23]=l("ul",null,[l("li",null,[l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("漂移了5号，因此是"),l("strong",{style:{color:"red"}},"305"),o("-5="),l("strong",{style:{color:"blue"}},"300")]),l("li",null,[l("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("相对"),l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("只漂移了1号（只有“NAPSYA注册了2次”影响它），因此是"),l("strong",{style:{color:"blue"}},"300"),o("+1="),l("strong",{style:{color:"green"}},"301")])],-1)),t[24]||(t[24]=l("p",null,"其实对于建筑列表，由于地图编辑器中显示的序号相对游戏内部实际起作用的序号只受“NAPSYA注册了2次”影响，因此就是241之前不漂移，241之后漂移1号，就这么简单。",-1)),t[25]||(t[25]=l("p",null,"至于动画列表的漂移状况十分复杂，我还是用程序来处理吧……",-1)),t[26]||(t[26]=l("hr",null,null,-1)),t[27]||(t[27]=l("p",null,"说了这么多，有什么可以直接使用的结论吗？",-1)),t[28]||(t[28]=l("p",null,"有。",-1)),p(g,{size:"5.32KB",netdisk:"",direct:"rules注册号漂移计算-Downloads.zip",name:"rules注册号漂移计算-Downloads.zip"}),t[29]||(t[29]=l("p",null,"（2021.5.23更新：修复了由于搞错一个物体注册多次时的判定顺序而引发的局部漂移。）",-1)),t[30]||(t[30]=l("p",null,"这其中的两个文件就是经过程序处理完毕的原版[Animations]和[BuildingTypes]注册表。你可以有两种办法来使用它：",-1)),t[31]||(t[31]=l("ul",null,[l("li",null,[o("在你需要寻找某一个物体"),l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("的时候，就可以在对应的文件里面查找，找到的就是正确的序号，填到地图编辑器里面没问题。")]),l("li",null,[o("把这两个文件里面的列表复制到rulesmd.ini里面，覆盖原来的列表（如果你添加了新的物体，在后面按顺序正常注册即可）。覆盖完成以后，"),l("strong",{style:{color:"blue"}},"游戏内部实际起作用的序号"),o("、"),l("strong",{style:{color:"green"}},"地图编辑器中显示的序号"),o("和"),l("strong",{style:{color:"red"}},"在rules文件中这一条目的注册号"),o("会变得完全一致，也就是一劳永逸的修复了这个bug。")])],-1)),t[32]||(t[32]=l("hr",null,null,-1)),t[33]||(t[33]=l("p",null,"2021.5.21更新：",-1)),t[34]||(t[34]=l("p",null,"我把计算注册号漂移的JavaScript程序打包进了一个网页，这样无需别的运行环境，只要一个浏览器就能打开运行了：",-1)),p(g,{size:"8.95KB",netdisk:"",direct:"rules注册号漂移计算.html",name:"rules注册号漂移计算.html"}),t[35]||(t[35]=l("p",null,"（2021.5.22更新：修复了自动合并空条目的bug。现在不会合并空条目，与游戏内部表现一致。）",-1)),t[36]||(t[36]=l("p",null,"可以直接使用这个程序导入你的rulesmd.ini来计算正确的注册号。",-1)),t[37]||(t[37]=l("p",null,"2021.5.23更新：",-1)),t[38]||(t[38]=l("p",null,"更改了一处错误的程序逻辑：一个物体注册多次，应该以先出现的那次为准，而非后出现的。",-1))]),"main-header":r(()=>[s(n.$slots,"main-header")]),"main-header-after":r(()=>[s(n.$slots,"main-header-after")]),"main-nav":r(()=>[s(n.$slots,"main-nav")]),"main-content":r(()=>[s(n.$slots,"main-content")]),"main-content-after":r(()=>[s(n.$slots,"main-content-after")]),"main-nav-before":r(()=>[s(n.$slots,"main-nav-before")]),"main-nav-after":r(()=>[s(n.$slots,"main-nav-after")]),comment:r(()=>[s(n.$slots,"comment")]),footer:r(()=>[s(n.$slots,"footer")]),aside:r(()=>[s(n.$slots,"aside")]),"aside-custom":r(()=>[s(n.$slots,"aside-custom")]),default:r(()=>[s(n.$slots,"default")]),_:3},8,["frontmatter"])}}};export{H as default};
